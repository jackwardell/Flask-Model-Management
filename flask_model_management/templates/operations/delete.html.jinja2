{% extends 'base_table.html.jinja2' %}

{% block form_card %}
    <form id="filter-form">
        <div role="form" id="form-content">
            {% for field in form.fields %}
                <div class="form-group">
                    {% if field.type == 'RadioField' %}
                        {{ field.label }}:
                        <div>
                            {% for subfield in field %}
                                <div class="form-check form-check-inline">
                                    {{ subfield(class="form-check-input") }}
                                    {{ subfield.label(class="form-check-label") }}
                                </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        {{ field.label }}:
                        {{ field(class="form-control mb-4") }}
                    {% endif %}
                </div>
            {% endfor %}
            <div class="form-group text-center">
                {{ form.confirm(class="btn btn-danger", value="delete") }}
            </div>
        </div>
    </form>
{% endblock %}

{% block scripts %}
    <script>
        function getFormData(formId, reset) {
            var formData = $("#" + formId + " :input")
                .filter(function (index, element) {
                    return $(element).val() != '';
                })
                .serialize();
            if (reset) {
                $("#" + formId).trigger("reset");
            }
            return formData
        }

        $("#confirm").on('click', function () {
            var formData = getFormData('filter-form', true)

            var success_alert = $("#success-alert")
            var failure_alert = $("#failure-alert")
            success_alert.hide()
            failure_alert.hide()

            if (confirm("Are you sure you want to delete these entries?")) {
                $.ajax({
                    url: '{{ get_url("delete", tablename=model.name) }}',
                    type: 'DELETE',
                    data: formData,
                    success: function (result) {
                        if (result.success) {
                            $("#success-text").text(result.message);
                            success_alert.show();
                        } else {
                            $("#failure-text").text(result.message);
                            failure_alert.show();
                        }
                    }
                })
            }
            return false;
        })
    </script>
{% endblock %}
